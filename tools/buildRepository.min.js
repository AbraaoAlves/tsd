function GUID(){var n=function(){return Math.floor(Math.random()*65536).toString(16)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function endsWith(n,t){return n.indexOf(t,n.length-t.length)!==-1}function fromFile(n,t,i){var u=[],r={};return r.uri={},r.uri.sourceType=1,r.uri.relative=t+"/"+i,r.uri.source=n.file,u.push(r),u}function fromTsdLibs(n,t,i){for(var e=[],o="../../tsd-libs/libs/"+n.dir,s=(new NodeJs.DirectoryHandle).getAllFiles(o,null,{recursive:!0}),h,f,r,u=0;u<s.length;u++)h=s[u],f=h.substr(o.length+1),console.log(f),r={uri:{}},r.uri.sourceType=1,r.uri.relative=t+(i?"/"+i:""),r.uri.source="https://raw.github.com/Diullei/tsd-libs/master/libs/"+n.dir+"/"+f,r.uri.pre="/Diullei/tsd-libs/master/libs/"+n.dir+"/",e.push(r);return e}function buildSource(n,t,i){var r={};return n&&(n.target=="file"?r.sources=fromFile(n,t,i):n.target=="tsd-libs"&&(r.sources=fromTsdLibs(n,t,i))),r}for(var fs=require("fs"),files=(new NodeJs.DirectoryHandle).getAllFiles("../repo_data"),repo=[],repo_v2=[],repo_site=[],docs=[],x,sw,sw2,sw3,i=0;i<files.length;i++){console.log(files[i]);var content=(new NodeJs.FileHandle).readFile(files[i]),obj=JSON.parse(content),v2lib={name:obj.name,description:obj.description,versions:[]};for(x=0;x<obj.versions.length;x++)v2lib.versions.push({version:obj.versions[x].version,key:obj.versions[x].key,dependencies:obj.versions[x].dependencies,uri:{source:obj.versions[x].url,sourceType:1},author:{name:obj.versions[x].author,url:obj.versions[x].author_url},lib:buildSource(obj.versions[x].lib,obj.name,obj.versions[x].version)}),delete obj.versions[x].lib;repo_v2.push(v2lib),repo.push(obj),repo_site.push({name:obj.name,description:obj.description,key:obj.versions[0].key,dependencies:obj.versions[0].dependencies,version:obj.versions[0].version,author:obj.versions[0].author,author_url:obj.versions[0].author_url,url:obj.versions[0].url})}sw=(new NodeJs.FileHandle).createFile("../deploy/repository.json"),sw.write(JSON.stringify(repo)),sw.flush(),sw.close(),sw2=(new NodeJs.FileHandle).createFile("../../tsdpm-site/tmpl/repository.js"),sw2.write("var __repo = "+JSON.stringify(repo_site)+";"),sw2.flush(),sw2.close(),sw3=(new NodeJs.FileHandle).createFile("../../tsdpm-site/repository_v2.json"),sw3.write(JSON.stringify({repo:repo_v2})),sw3.flush(),sw3.close()